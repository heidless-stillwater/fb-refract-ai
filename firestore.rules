/**
 * @fileoverview Firestore Security Rules for Refract AI (AI Image Hub).
 *
 * Core Philosophy:
 * This ruleset provides public read and write access to transformed image data,
 * as all users are anonymous. Security measures focus on preventing abuse
 * rather than enforcing user-based authorization. Data validation beyond
 * authorization is not performed in this prototyping phase.
 *
 * Data Structure:
 * - Transformed images are stored in `/transformedImages/{transformedImageId}`.
 * - Contact messages are stored in `/dnd_contactMessages/{contactMessageId}`.
 *
 * Key Security Decisions:
 * - Public read access is granted to all `transformedImages`.
 * - Write access for images is open to prevent blocking anonymous users.
 * - For contact messages, any authenticated user can create a message.
 * - All authenticated users can read all contact messages.
 *
 * WARNING: This ruleset does NOT provide adequate protection against abuse.
 *          It MUST be extended with rate limiting, input validation, and
 *          potentially CAPTCHA or similar mechanisms before being deployed
 *          to a production environment.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access to transformed image data.
     * @path /transformedImages/{transformedImageId}
     * @allow (get, list) User can retrieve or list transformed images.
     * @deny (create, update, delete) N/A - all users can create, update, and delete images.
     * @principle Allows open access to image data.
     */
    match /transformedImages/{transformedImageId} {
      allow read, write: if true; // WARNING: Open access! Add abuse prevention.
    }

    /**
     * @description Rules for the contact messages collection.
     * @path /dnd_contactMessages/{contactMessageId}
     * @allow (create) Any authenticated user can submit a message.
     * @allow (list, get) Any authenticated user can read messages.
     * @principle Enables a public message board style contact form.
     */
    match /dnd_contactMessages/{contactMessageId} {
      allow create: if request.auth != null;
      allow list, get: if request.auth != null;
      // Note: Update and delete are intentionally disallowed for all users.
    }
  }
}
