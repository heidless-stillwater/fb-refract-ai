{
  "entities": {
    "Image": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Image",
      "type": "object",
      "description": "Represents an image uploaded and transformed by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Image entity."
        },
        "originalImageUrl": {
          "type": "string",
          "description": "URL of the original uploaded image.",
          "format": "uri"
        },
        "transformedImageUrl": {
          "type": "string",
          "description": "URL of the transformed image after AI processing.",
          "format": "uri"
        },
        "transformationType": {
          "type": "string",
          "description": "Type of AI transformation applied (e.g., style transfer, background removal)."
        },
        "uploadTimestamp": {
          "type": "string",
          "description": "Timestamp of when the image was uploaded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "originalImageUrl",
        "transformedImageUrl",
        "transformationType",
        "uploadTimestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/images/{imageId}",
        "definition": {
          "entityName": "Image",
          "schema": {
            "$ref": "#/backend/entities/Image"
          },
          "description": "Stores image data for each user. The userId corresponds to the Firebase Authentication UID. Includes an imageId for each transformed image. The userId ensures path-based ownership, so only the authenticated user can access their images.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            },
            {
              "name": "imageId",
              "description": "The unique ID of the image."
            }
          ]
        }
      }
    ],
    "reasoning": "Given the application's focus on image transformations and minimal user authentication, a straightforward, path-based ownership model is recommended for storing image data. Each user, even anonymous, will have their own dedicated space under `/users/{userId}/images/{imageId}`. This structure provides clear ownership and simplifies security rules, ensuring that users can only access and manage their own images. Since there's no collaborative aspect or sharing of images between users, there's no need for membership maps or complex access control mechanisms. The `userId` will be the `uid` generated by Firebase Authentication, even for anonymous users.\n\nThis structure supports the required QAPs (Queries and Permissions) because it isolates each user's data into their own collection. This ensures that listing operations are secure and only return images belonging to the currently authenticated user. There is also no need for any authorization independence because the resources are private."
  }
}